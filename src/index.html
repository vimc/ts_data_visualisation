<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"></script>

    <link type="text/css" rel="stylesheet" href="bootstrap.css"/>
    <link type="text/css" rel="stylesheet" href="styles.css"/>
    <link type="text/css" rel="stylesheet" href="select2.min.css"/>
    <link type="text/css" rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css"/>
    <link type="text/css" rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.theme.css"/>

    <!-- We seem to need this to get the collapsable card to work -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.0/css/bootstrap4-toggle.min.css"
          rel="stylesheet">

    <style>
        .select2-container {
            width: 100% !important;
        }

        .select2-selection__choice {
            color: white;
            background-color: #0056b3 !important;
            border-color: #0056b3 !important;
            border-radius: 0px !important;
        }

        .select2-selection__choice__remove {
            color: white !important;
        }

        .dropdown-item:hover {
            color: #fff;
            text-decoration: none;
            background-color: #007bff;
        }
    </style>

    <!-- Loading Screen -->
    <script type="text/javascript">
        $(window).ready(function () {
            // Animate loader off screen
            $(".loader").fadeOut("fast");
        });
    </script>
</head>

<body>
<div class="loader"></div>

<div class="d-none page-wrapper" data-bind="css:{'d-none':false}">

    <nav class="navbar navbar-light d-block">
        <a class="navbar-brand" href="#">
            <img src="./logo-dark-drop.png" height="50px"/>
        </a>
        <div class="d-inline-block"
             style="color: #0056b3; font-size: 22px; font-weight: 500;vertical-align: -webkit-baseline-middle;">
            VIMC Data Visualisation Tool
        </div>
    </nav>

    <nav class="navbar navbar-light d-block py-0 px-1">
        <button class="btn btn-link dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">
            File
        </button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <a class="dropdown-item" href="#exportModal" data-toggle="modal" data-target="#exportModal">Export png</a>
            <a class="dropdown-item" href="#">Export csv</a>
            <hr/>
            <a class="dropdown-item" href="#">Export whole dataset</a>
        </div>
        <a href="#" style="border-left: 1px solid #007bff; padding-left: 15px;">
            Version
        </a>
    </nav>

    <div class="clearfix"></div>

    <div class="contents container-fluid">
        <div class="row">
            <div class="tab-content col-lg-8 col-md-9">
                <div id="impact" class="tab-pane" data-bind="css: {'active': currentPlot() == 'Impact'}">
                    <div class="p-5">

                        <p style="font-weight:bold;color:red"
                           data-bind="text: warningMessage, visible: showWarning">
                        </p>

                        <canvas id="myChart"></canvas>

                    </div>
                </div>
                <div id="timeseries" class="tab-pane"
                     data-bind="css: {'active': currentPlot() == 'Time series'}">
                    <div class="p-5">

                        <p style="font-weight:bold;color:red"
                           data-bind="text: warningMessage, visible: showWarning">
                        </p>

                        <div style="max-width: 1000px">
                            <canvas id="timeSeriesChart"></canvas>
                        </div>

                        <!--           <p>
                                    When stratifying by anything other than disease, the plots might overstate the total figures. This is because we might count the same person as dying from different diseases.
                                  </p> -->
                    </div>
                </div>
                <form class="px-5">
                    <div class="form-group row">
                        <div class="col">
                            <label>
                                Compare across <span class="info icon" data-toggle="tooltip" data-placement="top"
                                                     title="What should we use as the x-axis for the graph?"></span>
                            </label>
                            <select class="form-control" data-bind="options: xAxisOptions, value: xAxis"></select>
                            <div class="form-check mt-3" data-bind="visible: xAxis() == 'year'">
                                <input class="form-check-input" type="checkbox" data-bind="checked: cumulativePlot"
                                       id="cumulativePlotId">
                                <label class="form-check-label" for="cumulativePlotId">
                                    Cumulative
                                </label>
                            </div>
                        </div>
                        <div class="col">
                            <label>Stratify by <span class="info icon" data-toggle="tooltip" data-placement="top"
                                                     title="What should we stratify by?"></span>
                            </label>
                            <select class="form-control" data-bind="options: yAxisOptions, value: yAxis"></select>
                        </div>
                        <div class="col">
                            <label style="display: block">Show top</label>
                            <select type="number" class="form-control"
                                    style="width: 100px; display:inline;margin-right: 5px;"
                                    data-bind="options: maxPlotOptions, value: maxBars"></select> values
                            <div class="form-check mt-3">
                                <input class="form-check-input" type="checkbox"
                                       data-bind="checked: hideLabels"
                                       id="hideLabelsId">
                                <label class="form-check-label" for="hideLabelsId">Hide Labels</label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="col-3 mt-5 pr-5">
                <form>
                    <div class="form-group">
                        <label>Metric</label>
                        <select class="form-control" data-bind="value:  humanReadableBurdenOutcome">
                            <option value="deaths">Deaths</option>
                            <option value="deaths_averted">Deaths averted</option>
                            <option value="dalys">Dalys</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Method</label>
                        <select class="form-control" data-bind="value: yearMethod">
                            <option value="cross">Cross-sectional</option>
                            <option value="cohort">Lifetime</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Age</label>
                        <select class="form-control" data-bind="value: ageGroup">
                            <option value="all">All</option>
                            <option value="under5">Under 5</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Country</label>
                        <select multiple="multiple" class="form-control"
                                data-bind="select2: { placeholder: 'Select...', closeOnSelect: true }">
                        </select>
                    </div>
                    <div class="form-group" data-bind="with: vaccineFilter,
                     visible: showVaccineFilter">
                        <label>Disease/vaccine</label>
                        <select multiple="multiple" class="form-control"
                                data-bind="options: options, selectedOptions: selectedOptions,
                                select2: { placeholder: 'Select...', closeOnSelect: true }">
                        </select>
                    </div>
                </form>
            </div>
        </div>

    </div>

</div>

<div class="modal fade" id="exportModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Export plot as png</h3>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="plot-title" class="col-form-label">Plot title</label>

                        <input type="text" id="plot-title" class="form-control"
                               data-bind="value: plotTitle"/>

                    </div>
                    <div class="form-group">
                        <label for="plot-title" class="col-form-label">File name</label>

                        <input type="text" id="file-name" class="form-control"
                               data-bind="value: fileName"/>
                    </div>
                    <div class="form-group">
                        <button class="btn btn-success"  data-dismiss="modal" data-bind="click: exportPlot">Export</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Help Modal -->
<div class="modal fade" id="helpPlotModal" tabindex="-1" role="dialog" aria-labelledby="helpModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="helpModalLabel">
                    <span data-bind="text: modalHelpTitle"></span>
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <span data-bind="html: modalHelpMain"></span>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Filter Modal -->
<div class="modal fade" id="helpFilterModal" tabindex="-1" role="dialog" aria-labelledby="helFilterLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="helpFilterLabel">
                    Filter Options
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <span data-bind="html: modalFilterHelpMain"></span>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Metrics Modal -->
<div class="modal fade" id="helpMetricModal" tabindex="-1" role="dialog" aria-labelledby="helpMetricLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="helpMetricLabel">
                    Metrics
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <span data-bind="html: modalMetricsHelpMain"></span>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Method Modal -->
<div class="modal fade" id="methodModal" tabindex="-1" role="dialog" aria-labelledby="methodModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="methodModalLabel">Explanation of methods</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <a data-bind="visible: showCross"/></a>
                <h2>Cross-sectional</h2>
                <p>This method can be thought of as the impact by calendar year, <i>e.g.</i> the number of cases
                    prevented in a given year. While the resulting estimates are intuitively easy to understand, they
                    fail to represent the long-term future impact of vaccination on individual disease risk. In
                    addition, the impact estimates cannot be linked to specific vaccination activities.</p>
                </a>

                <a data-bind="visible: showCohort"/>
                <h2>Lifetime</h2>
                <p>This method can be thought of as the impact by birth year, <i>e.g.</i> the number of cases prevented
                    in a cohort born in a given year over the course of their lifetime. Note that we calculate impact
                    for birth cohorts from 2000 to 2030, and consider the lifetime up to 2100. A lifetime or cohort
                    approach to presenting impact is appropriate for capturing the direct effects of vaccination in
                    protecting the immunised individual. However, indirect effects of vaccination (acting via herd
                    immunity) play out across the whole population.</p>
                </a>

                <a data-bind="visible: showYearOfVac"/>
                <h2>Year of Vaccination</h2>
                <p>This is the approach used by VIMC to estimate vaccine impact by year of vaccination. It can be used
                    to easily determine the efficacy of a particular vaccination campaign.</p>
                </a>
                <hr>
                <p>More in-depth descriptions of the science underlying the methods can be found at the
                    <a href="https://www.vaccineimpact.org/resources/" target="_blank">Vaccine Impact Modelling
                        Consortium</a> website. In particular a in pre-print of the
                    <a href="https://medrxiv.org/cgi/content/short/19004358v1" target="_blank">first VIMC paper</a> and
                    the associated

                    <a href="https://www.vaccineimpact.org/resources/VIMC_impact_estimates-03Sep19.html"
                       target="_blank">technical description of the methods.</a></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Meta-data modal -->
<div class="modal fade" id="metadataModal" tabindex="-1" role="dialog" aria-labelledby="metadataModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="methodModalLabel">Plot Metadata</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <span data-bind="html: metaData"></span>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script src="bundle.js"></script>

</body>
</html>
