<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <link type="text/css" rel="stylesheet" href="bootstrap.css"/>
    <link type="text/css" rel="stylesheet" href="styles.css"/>
    <link type="text/css" rel="stylesheet" href="select2.min.css" />
    <link type="text/css" rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css"/>
    <link type="text/css" rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.theme.css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

    <!-- We seem to need this to get the collapsable card to work -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"></script>

    <!-- Loading Screen -->
    <script type="text/javascript">
        $(window).load(function() {
            // Animate loader off screen
        $(".loader").fadeOut("fast");
    });
    </script>

</head>

<body>
<div class="loader"></div>

<div class="d-none page-wrapper" data-bind="css:{'d-none':false}">

<nav class="navbar navbar-light d-block">
    <a class="navbar-brand" href="#">
        <img src="./logo-dark-drop.png"/>
    </a>
    <div class="d-inline-block"
         style="color: #0056b3; font-size: 22px; font-weight: 500;vertical-align: -webkit-baseline-middle;">
        VIMC Data Visualisation Tool
    </div>
    <div class="float-right small" style="color: #0056b3; white-space: pre-wrap;">
        <span data-bind="text: reportId"/></span>
        <span data-bind="text: dataId"/></span>
        <span data-bind="text: appId"/></span>
    </div>
</nav>

<div class="clearfix"></div>
<div class="sidebar in">
    <div class="m-3">Plots</div>
    <ul class="nav flex-column border-bottom border-top" data-bind="foreach: plots">
        <li class="nav-item">
            <a class="nav-link"
               href="#"
               data-bind="text: $data,
                              css: { active: $parent.currentPlot() == $data },
                              click: () => $parent.selectPlot($data)">
            </a>
        </li>
    </ul>
</div>

<div class="filter-bar sidebar" data-bind="css: { in: showSidebar}">
    <div class="m-3">
        <a href="#" data-bind="visible: !showSidebar(), click: () => showSidebar(true)"
           style="text-decoration: none !important;">
            <svg height="20" style="vertical-align: text-bottom;" viewBox="0 0 8 16" version="1.1" width="16"
                 aria-hidden="true">
                <path fill-rule="evenodd" fill="#007bff" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3l5 5z"></path>
            </svg>
            <svg height="20" style="vertical-align: text-bottom; margin-left:-12px;" viewBox="0 0 8 16" version="1.1"
                 width="16" aria-hidden="true">
                <path fill-rule="evenodd" fill="#007bff" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3l5 5z"></path>
            </svg>
        </a>
        <a href="#" data-bind="visible: showSidebar, click: () => showSidebar(false)"
           style="text-decoration: none !important;">
            <svg height="20" style="vertical-align: text-bottom;" class="octicon octicon-chevron-left"
                 viewBox="0 0 8 16" version="1.1" width="16" aria-hidden="true">
                <path fill-rule="evenodd"
                      fill="#007bff" d="M5.5 3L7 4.5 3.25 8 7 11.5 5.5 13l-5-5 5-5z"></path>
            </svg>
            <svg height="20" style="vertical-align: text-bottom; margin-left:-12px" class="octicon octicon-chevron-left"
                 viewBox="0 0 8 16" version="1.1" width="16" aria-hidden="true">
                <path fill-rule="evenodd"
                      fill="#007bff" d="M5.5 3L7 4.5 3.25 8 7 11.5 5.5 13l-5-5 5-5z"></path>
            </svg>
            <span style="margin-top: -10px">collapse filter menu</span>
        </a>
    </div>

    <ul class="nav flex-column border-bottom border-top" data-bind="visible: showSidebar">
        <li class="nav-item" data-bind="with: yearFilter">
            <a class="nav-link nav-parent"
               href="#"
               data-bind="text: name,
                              css: { active: isOpen },
                              click: toggleOpen"></a>

            <div class="filter clearfix" data-bind="css: {in: isOpen}">
                <div class="nav-item nav-option">
                    <div class="nav-link">
                        Year Low:
                        <select class=form-control data-bind="options: rangeValues, value: selectedLow"></select>
                    </div>
                </div>
                <div class="nav-item nav-option">
                    <div class="nav-link">
                        Year High:
                        <select class=form-control data-bind="options: rangeValues, value: selectedHigh"></select>
                    </div>
                </div>
            </div>
        </li>

        <li class="nav-item" data-bind="with: activityFilter">
            <a class="nav-link nav-parent"
               href="#"
               data-bind="text: name,
                              css: { active: isOpen },
                              click: toggleOpen"></a>

            <div class="filter clearfix" data-bind="css: {in: isOpen}, foreach: options">
                <div class="nav-item nav-option">
                    <div class="nav-link">
                        <label data-bind="attr: {for: $data}">
                            <input type="checkbox" data-bind="attr: {id: $data, value: $data},
                                checked: $parent.selectedOptions"/>
                            <span data-bind="text: $data"></span>
                        </label>
                    </div>
                </div>
            </div>
        </li>

        <li class="nav-item" data-bind="with: countryFilter">
            <a class="nav-link nav-parent"
               href="#"
               data-bind="text: name,
                              css: { active: isOpen },
                              click: toggleOpen"></a>

            <div class="filter clearfix" data-bind="css: {in: isOpen}">
                <div class="nav-item nav-option">
                    <div class="nav-link">
                        <button type="button" class="btn btn-primary mt-1 btn-sm" 
                                data-bind="click: selectCountryGroup('all')">
                            All
                        </button>
                        <button type="button" class="btn btn-primary mt-1 btn-sm"
                                data-bind="click: selectCountryGroup('none')">None
                        </button>
                        <button type="button" class="btn btn-primary mt-1 btn-sm"
                                data-bind="click: selectCountryGroup('gavi77')">
                            Gavi77
                        </button>
                        <button type="button" class="btn btn-primary mt-1 btn-sm"
                                data-bind="click: selectCountryGroup('gavi72')">
                            Gavi72
                        </button>
                        <button type="button" class="btn btn-primary mt-1 btn-sm"
                                data-bind="click: selectCountryGroup('gavi68')">
                            Gavi68
                        </button>
                        <button type="button" class="btn btn-primary mt-1 btn-sm"
                                data-bind="click: selectCountryGroup('dove94')">
                            Dove94
                        </button>
                        <button type="button" class="btn btn-primary mt-1 btn-sm"
                                data-bind="click: selectCountryGroup('dove96')">
                            Dove96
                        </button>
                        <button type="button" class="btn btn-primary mt-1 btn-sm"
                                data-bind="click: selectCountryGroup('pine')">
                            pine5
                        </button>
                    </div>
                </div>
                <hr>
                <div data-bind="foreach: options">
                    <div class="nav-item nav-option">
                        <div class="nav-link">
                            <label data-bind="attr: {for: $data}">
                                <input type="checkbox"
                                       data-bind="attr: { value: $data, id: $data }, checked: $parent.selectedOptions">
                                <span data-bind="text: $parent.makeHumanreadable($data)"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </li>

        <li class="nav-item" data-bind="with: diseaseFilter">
            <a class="nav-link nav-parent"
               href="#"
               data-bind="text: name,
                              css: { active: isOpen },
                              click: toggleOpen"></a>

            <div class="filter clearfix" data-bind="css: {in: isOpen}, foreach: vaccineFilters">
                <div class="nav-item nav-option">
                    <div class="nav-link">
                        <label data-bind="attr: {for: name}">
                            <span data-bind="text: makeHumanreadable(name())"></span>
                            <select multiple="multiple" class="form-control"
                                    data-bind="options: options, selectedOptions: selectedOptions,
                                      select2: { placeholder: 'Select vaccines', closeOnSelect: true }">
                            </select>
                        </label>
                    </div>
                </div>
            </div>
        </li>
        <li class="nav-item" data-bind="with: touchstoneFilter">
            <a class="nav-link nav-parent"
               href="#"
               data-bind="text: name,
                              css: { active: isOpen },
                              click: toggleOpen"></a>

            <div class="filter clearfix" data-bind="css: {in: isOpen}, foreach: options">
                <div class="nav-item nav-option">
                    <div class="nav-link">
                        <label data-bind="attr: {for: $data}">
                            <input type="checkbox"
                                   data-bind="attr: { value: $data, id: $data }, checked: $parent.selectedOptions">
                            <span data-bind="text: $data"></span>
                        </label>
                    </div>
                </div>
            </div>
        </li>
        <li class="nav-item" data-bind="with: supportFilter">
            <a class="nav-link nav-parent"
               href="#"
               data-bind="text: name,
                              css: { active: isOpen },
                              click: toggleOpen"></a>

            <div class="filter clearfix" data-bind="css: {in: isOpen}, foreach: options">
                <div class="nav-item nav-option">
                    <div class="nav-link">
                        <label data-bind="attr: {for: $data}">
                            <input type="checkbox"
                                   data-bind="attr: { value: $data, id: $data }, checked: $parent.selectedOptions">
                            <span data-bind="text: $data"></span>
                        </label>
                    </div>
                </div>
            </div>
        </li>
    </ul>
</div>

<div class="contents container-fluid">
    <div class="tab-content">
        <div id="impact" class="container tab-pane" data-bind="css: {'active': currentPlot() == 'Impact'}">
            <div class="row">
                <div class="col-12 p-5">
                    <form class="mb-5">
                        <div class="form-group row">
                            <div class="col-4">
                                <p>Compare across <span class="info icon" data-toggle="tooltip" data-placement="top"
                                                        title="What should we use as the x-axis for the graph?">
                            </span></p>
                                <select class="form-control" data-bind="options: xAxisOptions, value: compare"></select>
                            </div>
                            <div class="col-4" style="margin-top: 46px;">
                                <div class="form-check" data-bind="visible: compare() == 'year'">
                                    <input class="form-check-input" type="checkbox" data-bind="checked: cumulativePlot"
                                           id="cumulativePlotId">
                                    <label class="form-check-label" for="cumulativePlotId">
                                        Cumulative
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-4">
                                <p>Disaggregate by <span class="info icon" data-toggle="tooltip" data-placement="top"
                                                         title="What should we disaggregate by?">
                            </span></p>
                                <select class="form-control" data-bind="options: disaggregationOptions, value: disaggregateBy"></select>
                            </div>
                            <div class="col-4">
                                <p>Max bars <span class="info icon" data-toggle="tooltip" data-placement="top"
                                                  title="How many values should we plot on the x-axis?">
                           </span></p>
                                <select type="number" class="form-control" style="width: 100px;"
                                        data-bind="options: maxPlotOptions, value: maxBars"></select>
                            </div>
                        </div>
                    </form>

                    <div class="btn-group mt-1 mb-5" role="group">
                        <button type="button" class="btn btn-primary active" data-bind="click: () => changeBurden('deaths'),
                         css: {active: humanReadableBurdenOutcome() == 'deaths'}">Deaths
                        </button>
                        <button type="button" class="btn btn-primary" data-bind="click: () => changeBurden('dalys'),
                         css: {active: humanReadableBurdenOutcome() == 'dalys'}">Dalys
                        </button>
                        <button type="button" class="btn btn-primary" data-bind="click: () => changeBurden('cases'),
                         css: {active: humanReadableBurdenOutcome() == 'cases'}">Cases
                        </button>
                        <button type="button" class="btn btn-primary" data-bind="click: () => changeBurden('fvps'),
                         css: {active: humanReadableBurdenOutcome() == 'fvps'}">FVPS
                        </button>
                    </div>

                    <p style="font-weight:bold;color:red"
                        data-bind="text: warningMessage, visible: showWarning">
                    </p>

                    <div style="max-width: 1000px">
                        <canvas id="myChart"></canvas>
                    </div>

                    <form class="mt-3">
                        <div class="form-group row">
                            <div class="col-1">
                                <label for="plot-title" class="col-form-label">Title</label>
                            </div>
                            <div class="col-12 col-sm-7">
                                <input type="text" id="plot-title" class="form-control" data-bind="value: plotTitle"/>
                            </div>
                            <div class="col-12 col-sm-4">
                                <button class="btn btn-success" data-bind="click: applyTitle">Apply</button>
                                <button class="btn btn-success" data-bind="click: resetTitle">Reset</button>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-12">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" data-bind="checked: hideLabels"
                                           id="hideLabelsId">
                                    <label class="form-check-label" for="hideLabelsId">Hide Labels</label>
                                </div>
                            </div>
                        </div>
                    </form>

                    <button class="btn btn-success" data-bind="click: exportPlot">Export plot as png</button>
                    <button class="btn btn-success" data-bind="click: exportData">Export data as csv</button>
                </div>
            </div>
        </div>
        <div id="timeseries" class="container tab-pane" data-bind="css: {'active': currentPlot() == 'Time series'}">
            <div class="row">
                <div class="col-12 p-5">
                    <form class="mb-5">
                        <div class="form-group row">
                            <div class="col-4">
                                <p>Disaggregate by <span class="info icon" data-toggle="tooltip" data-placement="top"
                                                         title="What should we disaggregate by?">
                            </span></p>
                                <select class="form-control" data-bind="options: disaggregationOptions, value: disaggregateBy"></select>
                            </div>
                            <div class="col-4" style="margin-top: 46px;">
                                <div class="form-check"
                                     data-bind="visible: ['deaths_averted', 'cases_averted', 'dalys_averted', 'fvps'].includes(burdenOutcome())">
                                    <input class="form-check-input" type="checkbox" data-bind="checked: cumulativePlot"
                                           id="cumulativePlotId">
                                    <label class="form-check-label" for="cumulativePlotId">
                                        Cumulative
                                    </label>
                                </div>
                            </div>
                        </div>
                    </form>

                    <div class="btn-group mt-1 mb-6" role="group">
                        <button type="button" class="btn btn-primary active" data-bind="click: () => changeBurden('deaths'),
                         css: {active: humanReadableBurdenOutcome() == 'deaths'}">Deaths
                        </button>
                        <button type="button" class="btn btn-primary" data-bind="click: () => changeBurden('dalys'),
                         css: {active: humanReadableBurdenOutcome() == 'dalys'}">Dalys
                        </button>
                        <button type="button" class="btn btn-primary" data-bind="click: () => changeBurden('cases'),
                         css: {active: humanReadableBurdenOutcome() == 'cases'}">Cases
                        </button>
                        <button type="button" class="btn btn-primary" data-bind="click: () => changeBurden('fvps'),
                         css: {active: humanReadableBurdenOutcome() == 'fvps'}">FVPS
                        </button>
                        <button class="btn btn-warning" type="button" class="btn btn-primary" data-bind="click: () => changeBurden('coverage'),
                         css: {active: humanReadableBurdenOutcome() == 'coverage'}">Coverage
                        </button>
                        <button class="btn btn-warning" type="button" class="btn btn-primary" data-bind="click: () => changeBurden('deathsRate'),
                         css: {active: humanReadableBurdenOutcome() == 'deathsRate'}">Deaths (rate)
                        </button>
                        <button class="btn btn-warning" type="button" class="btn btn-primary" data-bind="click: () => changeBurden('casesRate'),
                         css: {active: humanReadableBurdenOutcome() == 'casesRate'}">Cases (rate)
                        </button>
                    </div>

                    <p style="font-weight:bold;color:red"
                        data-bind="text: warningMessage, visible: showWarning">
                    </p>

                    <div style="max-width: 1000px">
                        <canvas id="timeSeriesChart"></canvas>
                    </div>
                    <button class="btn btn-success" data-bind="click: exportTSPlot">Export plot as png</button>
                    <button class="btn btn-success" data-bind="click: exportTSData">Export data as csv</button>

                </div>
            </div>
        </div>
        <!-- META-DATA TEXT BOX -->

        <div class="card" style="width: 50rem;">
            <div class="card-header">
                <a class="nav-link nav-parent collapsed"
                   data-toggle="collapse"
                   href="#showHideMeta"
                   aria-expanded="false"
                   aria-controls="showHideMeta">
                    <span class="if-collapsed">Show description</span>
                    <span class="if-not-collapsed">Hide description</span>
                </a>
            </div>
            <div style="white-space: pre-wrap" id="showHideMeta" class="card-body collapse" data-bind="text: metaData"></div>
        </div>


    </div>
</div>

</div>

<!-- WARNING This file needs to be in same directory otherwise
it will break the report on the portal  -->
<script src="reportInfo.js"></script>
<script src="bundle.js"></script>

</body>
</html>
